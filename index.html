<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dynasty 8 Property Map</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />

  <style>
    :root{ --sea:#0fa8d2; }
    html,body{ height:100%; margin:0; background:var(--sea); }
    .leaflet-container{ background:var(--sea); }
    #map{ position:absolute; inset:56px 0 0 0; display:none; }
    #toolbar{
      position:fixed; inset:0 0 auto 0; height:56px;
      display:flex; gap:12px; align-items:center; padding:8px 12px;
      background:rgba(30,30,30,.92); color:#fff;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      z-index:1000; backdrop-filter:blur(6px);
    }
    #toolbar label{ display:flex; align-items:center; gap:6px; }
    #toolbar input[type="checkbox"]{ transform:translateY(1px); }
    #toolbar button{ border:none; padding:8px 12px; border-radius:8px; cursor:pointer; background:#fff; color:#111; font-weight:700; }
    #toolbar button:hover{ filter:brightness(.95); }
    .leaflet-tooltip{ background:#111; color:#fff; border-radius:6px; border:0; }
    .popup h3{ margin:0 8px 6px 0; font-size:16px; display:inline-block; }
    .popup p{ margin:0 0 6px; }
    .popup small{ color:#666; display:block; margin-top:6px; }
    #status{ position:absolute; inset:56px 0 0 0; display:grid; place-items:center; font:14px/1.4 system-ui; color:#333; padding:24px; text-align:center; }
    #status code{ background:#eee; padding:2px 6px; border-radius:4px; }
    #version{
      position:fixed; bottom:6px; right:10px; font:12px/1 monospace; color:rgba(255,255,255,.92);
      background:rgba(0,0,0,.6); padding:2px 6px; border-radius:4px; z-index:2000;
    }
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.45); z-index:1500; }
    .modal.show{ display:grid; }
    .card{
      width:min(560px, calc(100vw - 24px)); max-height:85vh; overflow:auto;
      background:#fff; color:#111; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.25);
      font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }
    .card header, .card footer{ padding:12px 14px; background:#f5f5f5; }
    .card header{ border-radius:12px 12px 0 0; font-weight:700; }
    .card footer{ border-radius:0 0 12px 12px; display:flex; gap:8px; justify-content:flex-end; }
    .card main{ padding:14px; display:grid; gap:12px; }
    .row{ display:grid; gap:6px; }
    .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    label span{ font-weight:600; font-size:13px; }
    input[type="text"], input[type="url"], input[type="number"], select{
      width:100%; padding:8px 10px; border:1px solid #ddd; border-radius:8px; font:14px system-ui;
    }
    .muted{ color:#666; font-size:12px; }
    .link-row{ display:grid; grid-template-columns:1fr 2fr; gap:8px; align-items:center; }
    .btn{ border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .btn.primary{ background:#111; color:#fff; }
    .btn.ghost{ background:#eee; }
  </style>
</head>
<body>
  <div id="toolbar">
    <div><strong>Dynasty 8 Property Map</strong></div>
    <label id="addWrap" style="display:none"><input type="checkbox" id="addMode"> Add</label>
    <label id="editWrap" style="display:none"><input type="checkbox" id="editMode"> Edit</label>
    <button id="unlockBtn">Unlock</button>
    <button id="lockBtn" style="display:none">Lock</button>
    <span id="hint">Loading…</span>
  </div>

  <div id="status">Looking for <code>map.jpg</code> in this folder…</div>
  <div id="map"></div>
  <div id="version"></div>

  <!-- Add Property Modal -->
  <div id="addModal" class="modal" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="addTitle">
      <header id="addTitle">Add Property</header>
      <main>
        <div class="row">
          <label><span>Name</span>
            <input id="f-name" type="text" placeholder="e.g., Eclipse Towers Apt. 3" />
          </label>
        </div>
        <div class="grid-2">
          <label><span>Type</span>
            <select id="f-type">
              <option value="apartment" selected>Apartment</option>
              <option value="office">Office</option>
              <option value="motel">Motel</option>
              <option value="penthouse">Penthouse</option>
            </select>
          </label>
          <div class="row"><span class="muted">Type controls link fields.</span></div>
        </div>
        <div id="linksArea" class="row"></div>
        <div class="muted" id="coordsNote">Will be placed where you clicked.</div>
      </main>
      <footer>
        <button id="btnCancel" class="btn ghost">Cancel</button>
        <button id="btnSave" class="btn primary">Save</button>
      </footer>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInAnonymously, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // ==== Build / Version Info ====
    const VERSION = "beta 1.0.2";
    const VERSION_NOTE = "Penthouse links expanded to 1–8 (was 2–6)";
    document.getElementById("version").textContent = VERSION;
    console.log(`Dynasty 8 Map – ${VERSION} — ${VERSION_NOTE}`);

    // ==== Firebase config ====
    const firebaseConfig = {
      apiKey: "AIzaSyCcfOML9FD1Q5vcoCb3NdIlFKtx3LAovBc",
      authDomain: "dynasty8-property-map.firebaseapp.com",
      projectId: "dynasty8-property-map",
      storageBucket: "dynasty8-property-map.firebasestorage.app",
      messagingSenderId: "849316207524",
      appId: "1:849316207524:web:9c921ad842fc188d027f31",
      measurementId: "G-VXG629H337"
    };

    // === [the rest of the code remains unchanged except for Penthouse link range] ===

    // Inside buildLinksFields for penthouse:
    // Change min/max and range clamp to 1–8
    // (Look for `f-count` input and the Math.max/Math.min line)

    // In your file it should now be:
    // <input id="f-count" type="number" value="1" min="1" max="8"/>
    // const n = Math.max(1, Math.min(8, parseInt(fCount.value || "1", 10)));

    // … rest of the JS unchanged …
  </script>
</body>
</html>
